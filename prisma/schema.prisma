generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                          String                     @id
  name                        String
  email                       String                     @unique
  emailVerified               Boolean                    @default(false)
  image                       String?
  createdAt                   DateTime                   @default(now())
  updatedAt                   DateTime                   @default(now()) @updatedAt
  prenom1FinalSubmitted       Boolean                    @default(false)
  prenom2FinalSubmitted       Boolean                    @default(false)
  nominationFinalSubmitted    Boolean                    @default(false)
  keepNominationDefaultOrder  Boolean                    @default(false)
  accounts                    Account[]
  sessions                    Session[]
  movieSelectionsPrenom       UserMovieSelectionPrenom[]
  prenom2Selections           UserPrenom2Selection[]
  nominationRankings          UserNominationRanking[]

  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

model Movie {
  id                   Int                        @id @default(autoincrement())
  name                 String
  createdAt            DateTime                   @default(now())
  updatedAt            DateTime                   @updatedAt
  prenom1Order         Int?
  nominations          Nomination[]
  shortlistNominations ShortlistNomination[]
  userSelectionsPrenom UserMovieSelectionPrenom[]
  prenom2Selections    UserPrenom2Selection[]

  @@map("movie")
}

model UserMovieSelectionPrenom {
  id        Int      @id @default(autoincrement())
  userId    String
  movieId   Int
  rating    String
  ranking   Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, movieId])
  @@map("user_movie_selection_prenom")
}

model Category {
  id                   Int                    @id(map: "prenom2_category_pkey") @default(autoincrement())
  name                 String                 @unique(map: "prenom2_category_name_key")
  slug                 String                 @unique(map: "prenom2_category_slug_key")
  order                Int                    @default(0)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  isPrenom2            Boolean                @default(false)
  nominations          Nomination[]
  shortlistNominations ShortlistNomination[]
  selections           UserPrenom2Selection[]

  @@map("category")
}

model ShortlistNomination {
  id         Int      @id(map: "prenom2_category_movie_pkey") @default(autoincrement())
  categoryId Int
  movieId    Int
  createdAt  DateTime @default(now())
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade, map: "prenom2_category_movie_categoryId_fkey")
  movie      Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade, map: "prenom2_category_movie_movieId_fkey")

  @@unique([categoryId, movieId], map: "prenom2_category_movie_categoryId_movieId_key")
  @@map("shortlist_nomination")
}

model UserPrenom2Selection {
  id         Int      @id @default(autoincrement())
  userId     String
  categoryId Int
  movieId    Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  movie      Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, categoryId, movieId])
  @@map("user_prenom2_selection")
}

model Nomination {
  id           Int                     @id @default(autoincrement())
  categoryId   Int
  movieId      Int
  actorId      Int?
  defaultOrder Int?                    // 1-10 for best picture, 1-5 for others (order in official nomination list)
  createdAt    DateTime                @default(now())
  category     Category                @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  movie        Movie                   @relation(fields: [movieId], references: [id], onDelete: Cascade)
  actor        Actor?                  @relation(fields: [actorId], references: [id], onDelete: SetNull)
  userRankings UserNominationRanking[]

  @@unique([categoryId, movieId, actorId])
  @@map("nomination")
}

// ============================================
// USER NOMINATION RANKINGS (Oscar predictions)
// ============================================

model UserNominationRanking {
  id           Int        @id @default(autoincrement())
  userId       String
  nominationId Int
  ranking      Int        // 1-5 (or 1-10 for best picture)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  nomination   Nomination @relation(fields: [nominationId], references: [id], onDelete: Cascade)

  @@unique([userId, nominationId])
  @@map("user_nomination_ranking")
}

// ============================================
// ACTORS
// ============================================

enum Gender {
  MALE
  FEMALE
}

model Actor {
  id          Int          @id @default(autoincrement())
  fullName    String
  gender      Gender
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  nominations Nomination[]

  @@map("actor")
}
